import{h as le,w as u,au as te,r as ae,E as oe,q as d,X as v,o as i,O as c,P as s,_ as y,k as b,V as h,U as C,z as e,m as p,l as $,p as m,$ as se,ac as V,a8 as k,W as B,Z as N,Y as T}from"./vue-9888607f.js";import{t as ne,g as W,ah as x,ai as re}from"./index-d68ba36c.js";import{F as E}from"./index-d87f9e8e.js";import{b as K}from"./validate-905cfe5c.js";const ie={class:"title"},me={key:0},de=["src"],ue={class:"select-container"},ce={class:"select-container"},be=le({__name:"popupForm",setup(pe){const _=u(),t=te("baTable"),{t:o}=ne(),A=ae({update_time:[K({name:"date",title:o("message.update_time")})],create_time:[K({name:"date",title:o("message.create_time")})]}),f=u([]),g=u([]),w=u([]),I=u([]),U=u(null);let F="",S=!1;const L=()=>{W({url:x()+"/admin/dev/list",method:"get"}).then(n=>{w.value=n.data}).catch(n=>{console.error("请求数据失败",n)})},M=n=>{W({url:x()+"/admin/dev/list",method:"get",params:{key:n}}).then(l=>{I.value=l.data}).catch(l=>{console.error("请求数据失败",l)})},O=()=>{M(f.value),t.form.items.selectedProvince=f.value},R=()=>{t.form.items.selectedCity=g.value};oe(()=>{L()});function j(){f.value=[],g.value=[]}const q=()=>{const n=U.value.files[0];console.log(n),console.log(n.raw);const l=new FormData;l.append("file",n),re.post(x()+"/admin/index/upload",l,{headers:{"Content-Type":"multipart/form-data"}}).then(r=>{console.log(r),r.status==200?t.form.items.image_url=r.data.msg:console.error("文件上传失败: "+r.data.message)}).catch(r=>{console.error("请求失败: "+r.message)})},X=()=>{F="",S=!1};return(n,l)=>{const r=d("el-button"),D=d("el-form-item"),P=d("el-option"),z=d("el-select"),Y=d("el-form"),Z=d("el-scrollbar"),G=d("el-dialog"),H=v("drag"),J=v("zoom"),Q=v("loading"),ee=v("blur");return i(),c(G,{class:"ba-operate-dialog","close-on-click-modal":!1,"model-value":["Add","Edit"].includes(e(t).form.operate),onOpened:j,onClose:e(t).toggleForm,width:"50%"},{header:s(()=>[y((i(),b("div",ie,[h(C(e(t).form.operate?e(o)(e(t).form.operate):""),1)])),[[H,[".ba-operate-dialog",".el-dialog__header"]],[J,".ba-operate-dialog"]])]),footer:s(()=>[p("div",{style:$("width: calc(100% - "+e(t).form.labelWidth/1.8+"px)")},[m(r,{onClick:l[8]||(l[8]=a=>e(t).toggleForm())},{default:s(()=>[h(C(e(o)("Cancel")),1)]),_:1}),y((i(),c(r,{loading:e(t).form.submitLoading,onClick:l[9]||(l[9]=a=>e(t).onSubmit(_.value)),type:"primary"},{default:s(()=>[h(C(e(t).form.operateIds&&e(t).form.operateIds.length>1?e(o)("Save and edit next item"):e(o)("Save")),1)]),_:1},8,["loading"])),[[ee]])],4)]),default:s(()=>[y((i(),c(Z,{class:"ba-table-form-scrollbar"},{default:s(()=>[p("div",{class:se(["ba-operate-form","ba-"+e(t).form.operate+"-form"]),style:$("width: calc(100% - "+e(t).form.labelWidth/2+"px)")},[e(t).form.loading?B("",!0):(i(),c(Y,{key:0,ref_key:"formRef",ref:_,onSubmit:l[6]||(l[6]=V(()=>{},["prevent"])),onKeyup:l[7]||(l[7]=k(a=>e(t).onSubmit(_.value),["enter"])),model:e(t).form.items,"label-position":"right","label-width":e(t).form.labelWidth+"px",rules:A},{default:s(()=>[m(E,{label:e(o)("message.mes_important"),type:"radio",modelValue:e(t).form.items.mes_important,"onUpdate:modelValue":l[0]||(l[0]=a=>e(t).form.items.mes_important=a),prop:"mes_important",data:{content:{0:e(o)("message.mes_important 0"),1:e(o)("message.mes_important 1")}},placeholder:e(o)("Please select field",{field:e(o)("message.mes_important")})},null,8,["label","modelValue","data","placeholder"]),m(D,{label:e(o)("message.image_url")},{default:s(()=>[p("input",{class:"upload-demo",type:"file",ref_key:"fileInput",ref:U,onChange:q},null,544),e(S)?(i(),b("div",me,[p("img",{src:e(F),alt:"Uploaded Image"},null,8,de),m(r,{onClick:X,type:"text"},{default:s(()=>[h("删除")]),_:1})])):B("",!0)]),_:1},8,["label"]),m(E,{label:e(o)("message.mes_content"),type:"textarea",modelValue:e(t).form.items.mes_content,"onUpdate:modelValue":l[1]||(l[1]=a=>e(t).form.items.mes_content=a),prop:"mes_content","input-attr":{rows:3},onKeyup:[l[2]||(l[2]=k(V(()=>{},["stop"]),["enter"])),l[3]||(l[3]=k(V(a=>e(t).onSubmit(_.value),["ctrl"]),["enter"]))],placeholder:e(o)("Please input field",{field:e(o)("message.mes_content")})},null,8,["label","modelValue","placeholder"]),m(D,{label:e(o)("message.select")},{default:s(()=>[p("div",ue,[m(z,{class:"el-select",modelValue:f.value,"onUpdate:modelValue":l[4]||(l[4]=a=>f.value=a),clearable:"",placeholder:"选择年级或者班级",onChange:O,multiple:"",filterable:""},{default:s(()=>[(i(!0),b(N,null,T(w.value,a=>(i(),c(P,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),p("div",ce,[m(z,{class:"el-select",modelValue:g.value,"onUpdate:modelValue":l[5]||(l[5]=a=>g.value=a),clearable:"",placeholder:"选择班级或者学生",onChange:R,multiple:"",filterable:""},{default:s(()=>[(i(!0),b(N,null,T(I.value,a=>(i(),c(P,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1},8,["label"])]),_:1},8,["model","label-width","rules"]))],6)]),_:1})),[[Q,e(t).form.loading]])]),_:1},8,["model-value","onClose"])}}});export{be as _};
