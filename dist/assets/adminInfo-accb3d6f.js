import{h as Z,w as G,r as P,q as m,X as H,o as g,k as U,p as a,P as i,m as s,z as t,U as p,O as w,a9 as V,a8 as z,V as k,_ as J,Z as Q,Y as W}from"./vue-7c431e9b.js";import{c as y,v as ee,q as ne,t as F,f as ae,B as oe,$ as te,Y as le,_ as ie}from"./index-764fcd0d.js";import{b as v}from"./validate-6a14e75e.js";const S="/admin/routine.AdminInfo/",x=new Map([["index",S+"index"],["edit",S+"edit"],["log","/admin/auth.AdminLog/index"]]);function de(){return y({url:x.get("index"),method:"get"})}function me(c={}){return y({url:x.get("log"),method:"get",params:c})}function $(c){return y({url:x.get("edit"),method:"post",data:c},{showSuccessMessage:!0})}const re={class:"default-main"},se={class:"admin-info"},ue={class:"image-slot"},fe={class:"admin-info-base"},pe={class:"admin-nickname"},ge={class:"admin-other"},ce={class:"admin-info-form"},_e=Z({name:"routine/adminInfo",__name:"adminInfo",setup(c){const{t:o}=ee(),_=G(),I=ne(),e=P({adminInfo:{},formKey:F(),buttonLoading:!1,log:[],logFilter:{limit:12},logCurrentPage:1,logPageSize:12,logTotal:100,logLoading:!0});de().then(d=>{e.adminInfo=d.data.info,e.formKey=F(),e.logFilter.search=[{field:"admin_id",val:d.data.info.id,operator:"eq"}],b()});const b=()=>{me(e.logFilter).then(d=>{e.log=d.data.list,e.logTotal=d.data.total,e.logLoading=!1}).catch(()=>{e.logLoading=!1})},B=d=>{e.logPageSize=d,e.logFilter.limit=d,b()},D=d=>{e.logCurrentPage=d,e.logFilter.page=d,b()},K=P({nickname:[v({name:"required",title:o("routine.adminInfo.User nickname")})],email:[v({name:"email",title:o("routine.adminInfo.e-mail address")})],mobile:[v({name:"mobile",message:o("Please enter the correct field",{field:o("routine.adminInfo.phone number")})})],password:[v({name:"password"})]}),A=d=>{let n=new FormData;n.append("file",d.raw),le(n).then(u=>{u.code==1&&$({id:e.adminInfo.id,avatar:u.data.file.url}).then(()=>{I.dataFill({...I.$state,avatar:u.data.file.full_url}),e.adminInfo.avatar=u.data.file.full_url})})},h=()=>{_.value&&_.value.validate(d=>{if(d){let n={...e.adminInfo};delete n.last_login_time,delete n.username,delete n.avatar,e.buttonLoading=!0,$(n).then(()=>{I.dataFill({...I.$state,nickname:e.adminInfo.nickname}),e.buttonLoading=!1}).catch(()=>{e.buttonLoading=!1})}})};return(d,n)=>{const u=m("Icon"),T=m("el-image"),q=m("el-upload"),f=m("el-input"),r=m("el-form-item"),C=m("el-button"),N=m("el-form"),L=m("el-col"),R=m("el-timeline-item"),j=m("el-timeline"),M=m("el-pagination"),O=m("el-card"),Y=m("el-row"),E=H("loading");return g(),U("div",re,[a(Y,{gutter:30},{default:i(()=>[a(L,{class:"lg-mb-20",xs:24,sm:24,md:24,lg:10},{default:i(()=>[s("div",se,[a(q,{class:"avatar-uploader",action:"","show-file-list":!1,onChange:A,"auto-upload":!1,accept:"image/gif, image/jpg, image/jpeg, image/bmp, image/png, image/webp"},{default:i(()=>[a(T,{src:t(ae)(e.adminInfo.avatar),class:"avatar"},{error:i(()=>[s("div",ue,[a(u,{size:"30",color:"#c0c4cc",name:"el-icon-Picture"})])]),_:1},8,["src"])]),_:1}),s("div",fe,[s("div",pe,p(e.adminInfo.nickname),1),s("div",ge,[s("div",null,p(t(o)("routine.adminInfo.Last logged in on"))+" "+p(e.adminInfo.last_login_time),1)])]),s("div",ce,[(g(),w(N,{onKeyup:n[10]||(n[10]=V(l=>h(),["enter"])),key:e.formKey,"label-position":"top",rules:K,ref_key:"formRef",ref:_,model:e.adminInfo},{default:i(()=>[a(r,{label:t(o)("routine.adminInfo.user name")},{default:i(()=>[a(f,{disabled:"",modelValue:e.adminInfo.username,"onUpdate:modelValue":n[0]||(n[0]=l=>e.adminInfo.username=l)},null,8,["modelValue"])]),_:1},8,["label"]),a(r,{label:t(o)("routine.adminInfo.User nickname"),prop:"nickname"},{default:i(()=>[a(f,{placeholder:t(o)("routine.adminInfo.Please enter a nickname"),modelValue:e.adminInfo.nickname,"onUpdate:modelValue":n[1]||(n[1]=l=>e.adminInfo.nickname=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),a(r,{label:t(o)("routine.adminInfo.e-mail address"),prop:"email"},{default:i(()=>[a(f,{placeholder:t(o)("Please input field",{field:t(o)("routine.adminInfo.e-mail address")}),modelValue:e.adminInfo.email,"onUpdate:modelValue":n[2]||(n[2]=l=>e.adminInfo.email=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),a(r,{label:t(o)("routine.adminInfo.phone number"),prop:"mobile"},{default:i(()=>[a(f,{placeholder:t(o)("Please input field",{field:t(o)("routine.adminInfo.phone number")}),modelValue:e.adminInfo.mobile,"onUpdate:modelValue":n[3]||(n[3]=l=>e.adminInfo.mobile=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),a(r,{label:t(o)("routine.adminInfo.autograph"),prop:"motto"},{default:i(()=>[a(f,{onKeyup:[n[4]||(n[4]=V(z(()=>{},["stop"]),["enter"])),n[5]||(n[5]=V(z(l=>h(),["ctrl"]),["enter"]))],placeholder:t(o)("routine.adminInfo.This guy is lazy and doesn write anything"),type:"textarea",modelValue:e.adminInfo.motto,"onUpdate:modelValue":n[6]||(n[6]=l=>e.adminInfo.motto=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),a(r,{label:t(o)("routine.adminInfo.New password"),prop:"password"},{default:i(()=>[a(f,{type:"password",placeholder:t(o)("routine.adminInfo.Please leave blank if not modified"),modelValue:e.adminInfo.password,"onUpdate:modelValue":n[7]||(n[7]=l=>e.adminInfo.password=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),a(r,null,{default:i(()=>[a(C,{type:"primary",loading:e.buttonLoading,onClick:n[8]||(n[8]=l=>h())},{default:i(()=>[k(p(t(o)("routine.adminInfo.Save changes")),1)]),_:1},8,["loading"]),a(C,{onClick:n[9]||(n[9]=l=>t(oe)(_.value))},{default:i(()=>[k(p(t(o)("Reset")),1)]),_:1})]),_:1})]),_:1},8,["rules","model"]))])])]),_:1}),J((g(),w(L,{xs:24,sm:24,md:24,lg:12},{default:i(()=>[a(O,{header:t(o)("routine.adminInfo.Operation log"),shadow:"never"},{default:i(()=>[a(j,null,{default:i(()=>[(g(!0),U(Q,null,W(e.log,(l,X)=>(g(),w(R,{key:X,size:"large",timestamp:t(te)(l.create_time)},{default:i(()=>[k(p(l.title),1)]),_:2},1032,["timestamp"]))),128))]),_:1}),a(M,{currentPage:e.logCurrentPage,"page-size":e.logPageSize,"page-sizes":[12,22,52,100],background:"",layout:"prev, next, jumper",total:e.logTotal,onSizeChange:B,onCurrentChange:D},null,8,["currentPage","page-size","total"])]),_:1},8,["header"])]),_:1})),[[E,e.logLoading]])]),_:1})])}}});const he=ie(_e,[["__scopeId","data-v-2f63e55a"]]);export{he as default};
